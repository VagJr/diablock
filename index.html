<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<title>DIABLOCK V2.0v - EYES OF THE VOID</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
@import url('https://fonts.googleapis.com/css2?family=Courier+New&family=VT323&display=swap');

:root {
    --primary: #0f0;
    --primary-dim: #050;
    --danger: #f00;
    --mana: #00f;
    --gold: #fb0;
    --bg: #000;
    --panel-bg: rgba(0, 10, 0, 0.9);
    --border-glow: 0 0 10px rgba(0, 255, 0, 0.2);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html, body { 
    margin: 0; padding: 0; width: 100%; height: 100%; 
    background: var(--bg); overflow: hidden; 
    font-family: 'Courier New', monospace; user-select: none; 
    color: var(--primary); touch-action: none; 
}

canvas { 
    width: 100%; height: 100%; image-rendering: pixelated; 
    cursor: crosshair; display: block; 
}

/* Efeito CRT/Scanlines */
.scanlines { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    pointer-events: none; 
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03)); 
    background-size: 100% 3px, 3px 100%; z-index: 1000; 
}

#ui-layer { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    pointer-events: none; z-index: 10;
}

/* Painéis de Interface */
.panel { 
    display: none; position: absolute; 
    background: var(--panel-bg); border: 2px solid var(--primary); 
    padding: 15px; pointer-events: auto; color: var(--primary); 
    box-shadow: 6px 6px 0px var(--primary-dim);
    backdrop-filter: blur(4px);
    animation: panelSlide 0.2s ease-out;
}

@keyframes panelSlide {
    from { transform: translate(-50%, -45%); opacity: 0; }
    to { transform: translate(-50%, -50%); opacity: 1; }
}

#inventory { top: 50%; left: 70%; transform: translate(-50%, -50%); width: 300px; }
#char-panel { top: 50%; left: 20%; transform: translate(-50%, -50%); width: 220px; }
#craft-panel { top: 50%; left: 45%; transform: translate(-50%, -50%); width: 240px; border-color: #d0d; box-shadow: 6px 6px 0px #303; }
#shop-panel { top: 45%; left: 50%; transform: translate(-50%, -50%); width: 320px; border-color: #0ff; color: #0ff; box-shadow: 6px 6px 0px #033; }

.panel-header {
    text-align: center; font-weight: bold; border-bottom: 1px dashed currentColor;
    margin-bottom: 10px; padding-bottom: 5px; text-transform: uppercase;
    letter-spacing: 2px;
}

/* HUD Principal (PC) */
.hud-bottom { 
    position: absolute; bottom: 20px; left: 50%; 
    transform: translateX(-50%); display: flex; 
    flex-direction: column; align-items: center; 
}

.bar-box { 
    width: 320px; padding: 10px; background: rgba(0,0,0,0.85); 
    border: 2px solid var(--primary); margin-bottom: 10px;
    box-shadow: var(--border-glow);
}

.bar-container { 
    width: 100%; height: 10px; background: #111; 
    margin: 4px 0 8px 0; border: 1px solid var(--primary-dim); 
    overflow: hidden;
}

.fill { 
    height: 100%; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
}
.fill.hp { background: var(--danger); }
.fill.mp { background: var(--mana); }
.fill.xp { background: var(--gold); }

/* Skills & Atalhos */
.skills { display: flex; gap: 8px; pointer-events: auto; }
.skill-btn { 
    width: 42px; height: 42px; background: #000; 
    border: 2px solid var(--primary); color: var(--primary); 
    display: flex; align-items: center; justify-content: center; 
    font-size: 11px; font-weight: bold; cursor: pointer; 
    position: relative; transition: 0.1s;
}
.skill-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }
.skill-btn:active { transform: translateY(2px); }
.key-hint { position: absolute; top: -14px; font-size: 9px; color: #888; width: 100%; text-align: center; }

/* Grid de Itens */
.grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-top: 10px; }
.slot { 
    width: 48px; height: 48px; background: rgba(0,20,0,0.5); 
    border: 1px solid var(--primary); cursor: pointer; 
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; transition: 0.2s;
}
.slot:hover { background: var(--primary-dim); border-color: #fff; }

/* Game Log */
#game-log-container {
    position: absolute; top: 15px; right: 15px; 
    width: 280px; height: 180px; background: rgba(0, 5, 0, 0.8);
    border: 1px solid var(--primary-dim); padding: 8px;
    font-size: 11px; pointer-events: none;
}
#game-log { 
    display: flex; flex-direction: column-reverse; 
    gap: 4px; height: 100%; overflow: hidden; 
}

/* Gold Display */
#hud-gold { 
    position: absolute; top: 20px; left: 20px; 
    font-family: 'VT323', monospace; font-size: 28px; 
    color: var(--gold); text-shadow: 2px 2px #000; 
}

/* Mobile Controls */
#mobile-controls { display: none; position: fixed; bottom: 20px; width: 100%; height: 150px; z-index: 100; }
#action-container { position: absolute; right: 20px; bottom: 0; width: 180px; height: 180px; }

.action-btn { 
    position: absolute; width: 60px; height: 60px; 
    border-radius: 50%; background: rgba(20,20,20,0.85); 
    border: 2px solid var(--primary); color: #fff; 
    display: flex; align-items: center; justify-content: center; 
    font-weight: bold; font-size: 14px; pointer-events: auto;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}
.action-btn:active { transform: scale(0.9); background: var(--primary-dim); }

#btn-atk { width: 80px; height: 80px; bottom: 0; right: 0; border-color: var(--danger); font-size: 18px; }
#btn-skill { bottom: 85px; right: 10px; border-color: var(--mana); }
#btn-dash { bottom: 10px; right: 85px; border-color: #fff; }
#btn-potion { bottom: 90px; right: 85px; border-color: #f33; font-size: 10px; }
#btn-block { bottom: 10px; right: 155px; border-color: var(--primary); }

/* Mobile HUD Top */
#hud-horizontal-mobile {
    position: absolute; top: 0; left: 0; width: 100%; 
    height: 30px; background: #000; border-bottom: 1px solid var(--primary-dim);
    display: none; align-items: center; padding: 0 10px; font-size: 10px;
}

/* Botões Reutilizáveis */
.btn { 
    padding: 8px 15px; background: #000; color: var(--primary); 
    border: 2px solid var(--primary); cursor: pointer; 
    font-family: inherit; font-weight: bold; text-transform: uppercase;
}
.btn:hover { background: var(--primary); color: #000; }

/* Tooltip */
#tooltip { 
    position: absolute; background: #000; border: 1px solid #fff; 
    padding: 8px; z-index: 2000; display: none; font-size: 12px; 
    color: #fff; box-shadow: 4px 4px 0 rgba(0,0,0,0.5);
}

@media (max-width: 1024px) {
    .hud-bottom, #game-log-container { display: none !important; }
    #hud-horizontal-mobile { display: flex !important; }
    #mobile-controls { display: block; }
}

</style>
</head>
<body oncontextmenu="return false">

<canvas id="c"></canvas>
<div class="scanlines"></div>
<div id="tooltip"></div>

<div id="ui-layer">
    <div id="hud-gold">● 000,000G</div>
    
    <div id="game-log-container">
        <div id="game-log"></div>
    </div>

    <div id="hud-horizontal-mobile">
        <span id="h-lvl-txt">LVL 1</span>
        <div style="flex-grow:1; text-align:center; color:var(--gold)" id="h-gold-txt">0G</div>
        <div class="h-bar-container" style="width:50px; height:6px; background:#200; margin:0 5px;"><div class="fill hp" id="h-hp-bar" style="width:100%"></div></div>
        <div class="h-bar-container" style="width:40px; height:6px; background:#002; margin:0 5px;"><div class="fill mp" id="h-mp-bar" style="width:100%"></div></div>
    </div>

    <div class="hud-bottom">
        <div class="bar-box">
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:2px;">
                <span id="lvl-txt" style="color:var(--primary)">LEVEL 1</span>
                <span id="hp-txt" style="color:var(--danger)">100 / 100 HP</span>
            </div>
            <div class="bar-container"><div class="fill hp" id="hp-bar" style="width:100%"></div></div>
            
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:2px;">
                <span style="color:var(--mana)">ENERGY</span>
                <span id="mp-txt" style="color:var(--mana)">50 / 50 MP</span>
            </div>
            <div class="bar-container"><div class="fill mp" id="mp-bar" style="width:100%"></div></div>
            
            <div class="bar-container" style="height:4px;"><div class="fill xp" id="xp-bar" style="width:10%"></div></div>
        </div>

        <div class="skills">
            <div class="skill-btn" title="Ataque Básico"><span class="key-hint">M1</span>ATK</div>
            <div class="skill-btn" id="skill-1"><span class="key-hint">E</span>SKL</div>
            <div class="skill-btn" id="skill-dash"><span class="key-hint">SPC</span>DSH</div>
            <div class="skill-btn" id="hud-potion"><span class="key-hint">Q</span>POT</div>
            <div class="skill-btn" onclick="uiState.inv = !uiState.inv; updateUI()"><span class="key-hint">I</span>INV</div>
            <div class="skill-btn" onclick="uiState.craft = !uiState.craft; updateUI()"><span class="key-hint">K</span>CFT</div>
            <div class="skill-btn" onclick="uiState.char = !uiState.char; updateUI()"><span class="key-hint">C</span>CHR</div>
        </div>
    </div>

    <div id="inventory" class="panel">
        <div class="panel-header">Backpack</div>
        <div id="inv-grid" class="grid" style="grid-template-columns: repeat(5, 1fr);"></div>
    </div>

    <div id="char-panel" class="panel">
        <div class="panel-header">Hero Stats</div>
        <div class="equip-slots" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-bottom:15px;">
            <div class="slot" id="eq-head" style="grid-column: 2"></div>
            <div class="slot" id="eq-hand" style="grid-column: 1"></div>
            <div class="slot" id="eq-body" style="grid-column: 2"></div>
            <div class="slot" id="eq-rune" style="grid-column: 3"></div>
        </div>
        <div style="text-align:center; color:var(--gold); margin-bottom:10px;">Attributes: <span id="cp-pts">0</span></div>
        <div class="stat-row" style="display:flex; justify-content:space-between; margin: 5px 0;">
            <span>STR</span>
            <span><span id="val-str">5</span> <button class="plus-btn" onclick="addStat('str')">+</button></span>
        </div>
        <div class="stat-row" style="display:flex; justify-content:space-between; margin: 5px 0;">
            <span>DEX</span>
            <span><span id="val-dex">5</span> <button class="plus-btn" onclick="addStat('dex')">+</button></span>
        </div>
        <div class="stat-row" style="display:flex; justify-content:space-between; margin: 5px 0;">
            <span>INT</span>
            <span><span id="val-int">5</span> <button class="plus-btn" onclick="addStat('int')">+</button></span>
        </div>
    </div>

    <div class="ui-action-buttons" id="ui-action-buttons">
        <button class="btn" id="ui-btn-equip" onclick="handleGamepadAction()">USE</button>
        <button class="btn" id="ui-btn-drop" onclick="handleGamepadSecondaryAction()" style="border-color:var(--danger); color:var(--danger)">DROP</button>
    </div>
</div>

<div id="mobile-controls">
    <div id="joystick-base"></div>
    <div id="joystick-knob" style="display:none"></div>
    <div id="joystick-area"></div>

    <div id="action-container">
        <div id="btn-block" class="action-btn">DEF</div>
        <div id="btn-potion" class="action-btn">POT</div>
        <div id="btn-skill" class="action-btn">SKL</div>
        <div id="btn-dash" class="action-btn">DSH</div>
        <div id="btn-atk" class="action-btn">ATK</div>
    </div>
</div>

<div id="menu">
    <h1 style="font-family:'VT323'; font-size:80px; margin:0; letter-spacing:10px;">DIABLOCK</h1>
    <p style="color:var(--danger); margin-top:-10px; font-weight:bold;">V2.0v EYES OF THE VOID</p>
    
    <div id="login-form" style="margin-top:30px;">
        <input type="text" id="username" placeholder="IDENTIFY USER..." style="text-align:center; width:250px;">
        <br>
        <button class="btn" onclick="login()" style="width:250px; margin-top:10px; font-size:18px;">Enter Dungeon</button>
    </div>

    <div id="char-select" style="display:none; text-align:center; margin-top:20px;">
        <div id="char-list" style="margin-bottom:20px;"></div>
        <input type="text" id="cname" placeholder="HERO NAME..." maxlength="12">
        <br>
        <select id="cclass" style="width:200px;">
            <option value="knight">WARRIOR</option>
            <option value="hunter">RANGER</option>
            <option value="mage">WIZARD</option>
        </select>
        <br>
        <button class="btn" onclick="create()" style="width:200px; margin-top:10px;">Initialize</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/game.js"></script>
</body>
</html>
