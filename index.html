<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<title>DIABLOCK V26 - LEGADO DAS RUNAS SOMBRIAS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
@import url('https://fonts.googleapis.com/css2?family=Courier+New&display=swap');
html,body{ margin:0; width:100%; height:100%; background:#000; overflow:hidden; font-family:'Courier New', monospace; user-select:none; color:#0f0; touch-action: none; }
canvas{ width:100%; height:100%; image-rendering:pixelated; cursor: crosshair; display:block; touch-action: none;}
.scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 2px 100%; z-index: 999; }
#ui-layer{ position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
/* PC/Portrait HUD */
.hud-bottom{ position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; flex-direction:column; align-items:center; }
.bar-box{ width:300px; padding:5px 10px; background:rgba(0,0,0,0.8); border:2px solid #0f0; margin-bottom:5px; box-shadow: 0 0 10px #0f03; }
.bar-status-text{ display:flex; justify-content:space-between; font-size:12px; color:#fff; margin-bottom:2px; font-weight:bold; }
.bar-container{ width:100%; height:8px; background:#111; margin-bottom:4px; border:1px solid #040; position:relative; }
.bar-container.xp { height: 4px; }
.fill{ height:100%; transition:width 0.1s; }
.fill.hp{ background:#f00; } .fill.mp{ background:#00f; } .fill.xp{ background:#fb0; }
.skills{ display:flex; gap:5px; pointer-events:auto; align-items: flex-end; }
.skill-btn{ width:36px; height:36px; background:#000; border:2px solid #0f0; color:#0f0; display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:bold; cursor:pointer; position: relative;}
.skill-btn:hover { background: #0f0; color:#000; }
.key-hint { position: absolute; top:-12px; font-size: 8px; color: #aaa; }
/* Panels */
.panel{ display:none; position:absolute; background:#000; border:2px solid #0f0; padding:10px; pointer-events:auto; color:#0f0; box-shadow: 5px 5px 0px #003300; }
#inventory{ top:50%; left:65%; transform:translate(-50%, -50%); width:280px; }
#craft-panel{ top:50%; left:35%; transform:translate(-50%, -50%); width:220px; border-color:#d0d; color:#f0f; box-shadow: 5px 5px 0px #303; }
#char-panel{ top:50%; left:20%; transform:translate(-50%, -50%); width:200px; }
#shop-panel{ top:40%; left:50%; transform:translate(-50%, -50%); width:300px; border-color:#0ff; color:#0ff; }
.grid{ display:grid; grid-template-columns:repeat(8, 1fr); gap:4px; margin-top:10px; }
.slot{ width:28px; height:28px; background:#000; border:1px solid #0f0; cursor:pointer; position:relative; }
.slot:hover{ background:#0f0; }
.stat-row{ display:flex; justify-content:space-between; margin-bottom:5px; align-items:center; }
.plus-btn{ background:#000; border:1px solid #0f0; color:#0f0; width:16px; height:16px; line-height:14px; text-align:center; cursor:pointer; font-size:12px; }
.plus-btn:hover{ background:#0f0; color:#000; }
#tooltip { position: absolute; background: #000; border: 1px solid #fff; padding: 5px; z-index: 1000; display: none; pointer-events: none; font-size: 10px; color:#fff; white-space:nowrap; }
.equip-slots { display: flex; gap: 10px; justify-content: center; margin-bottom: 10px; flex-wrap: wrap; }
#menu{ position:absolute; top:0; left:0; width:100%; height:100%; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; pointer-events:auto; z-index:10; }
.btn{ padding:10px 20px; background:#000; color:#0f0; border:2px solid #0f0; margin:5px; cursor:pointer; font-family:inherit; font-weight:bold;}
.btn:hover{ background:#0f0; color:#000; }
.craft-item { padding: 5px; border-bottom: 1px solid #303; cursor:pointer; }
.craft-item:hover { background: #303; }
input, select{ padding:10px; background:#000; border:2px solid #0f0; color:#0f0; margin:5px; font-family:inherit;}
h1 { text-shadow: 2px 2px #f00; color: #d00; }
#hud-gold { position: absolute; top: 10px; left: 10px; font-size: 18px; color: #fb0; font-weight: bold; text-shadow: 1px 1px #000; }
/* CHAT INPUT */
#chat-container { position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); width: 300px; display: none; pointer-events: auto; }
#chat-input { width: 100%; background: rgba(0,0,0,0.8); border: 1px solid #0f0; color: #fff; padding: 5px; font-family: inherit; }

/* MOBILE CONTROLS */
#mobile-controls { 
    display: none; 
    position: fixed; 
    bottom: 0; 
    left: 0; 
    width: 100%; 
    height: 120px; 
    pointer-events: none; 
    z-index: 5; 
}

/* NOVO: Joystick Area (apenas para detec√ß√£o de toque) */
#joystick-area {
    position: absolute;
    bottom: 10px;
    left: 15px;
    width: 120px; 
    height: 120px;
    pointer-events: auto;
    /* Para visualiza√ß√£o do joystick */
    /* border: 1px solid rgba(0, 255, 0, 0.5); */
    border-radius: 50%;
    z-index: 1;
}

/* Novo: Visual do Joystick (c√≠rculo est√°tico no fundo) */
#joystick-base {
    position: absolute;
    left: 15px;
    bottom: 10px;
    width: 100px;
    height: 100px;
    border: 2px solid rgba(0, 255, 0, 0.5);
    background: rgba(0, 0, 0, 0.4);
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
    transform: translate(10px, 10px); /* Centraliza na √°rea de 120x120 */
}

/* Novo: Bot√£o (Knob) do Joystick */
#joystick-knob {
    position: absolute;
    width: 40px;
    height: 40px;
    background: rgba(0, 255, 0, 0.7);
    border: 1px solid #0f0;
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
    transition: transform 0.05s ease-out;
}

/* ACTION BUTTONS (Right Side) */
#action-container { 
    right: 15px; 
    width: 160px; 
    height: 100px; 
    bottom: 5px; 
    position: absolute;
    pointer-events: auto;
}
.action-btn { 
    position: absolute; 
    width: 45px; height: 45px; 
    border-radius: 50%; 
    background: rgba(0, 0, 0, 0.6); 
    border: 2px solid; 
    color: #f00; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 14px; 
    font-weight: bold; 
    box-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
    z-index: 2; /* Sobrep√µe o joystick base */
}

/* Posicionamento dos bot√µes de combate */
#btn-atk { 
    width: 55px; height: 55px; 
    font-size: 16px; 
    bottom: 5px; 
    right: 5px;
} 
#btn-skill { 
    width: 40px; height: 40px; 
    font-size: 10px; 
    border-color: #0ff; color: #0ff; 
    bottom: 55px; 
    right: 5px; 
} 
#btn-dash { 
    width: 40px; height: 40px; 
    font-size: 10px; 
    border-color: #fff; color: #fff;
    bottom: 5px; 
    right: 65px; 
} 
#btn-potion { 
    width: 35px; height: 35px; 
    font-size: 9px; 
    border-color: #f33; color: #f33;
    bottom: 60px; 
    right: 55px; 
}

/* HUD MENU BUTTONS (INV/CHR/CFT) */
#mobile-menu-buttons {
    position: absolute; 
    bottom: 110px; 
    right: 5px; 
    display: flex; 
    gap: 5px; 
    pointer-events: auto;
    z-index: 10; 
}
#mobile-menu-buttons .skill-btn {
    width: 38px; 
    height: 38px; 
    background: rgba(0,0,0,0.7); 
    font-size: 10px;
    border-radius: 5px;
}

/* NOVO: HUD MINUSCULO PARA MOBILE */
#hud-horizontal-mobile {
    position: absolute; 
    top: 0px; 
    left: 0px; 
    width: 100%; 
    height: 20px; 
    background: rgba(0, 0, 0, 0.8); 
    border-bottom: 1px solid #0f0;
    pointer-events: none;
    display: none; 
    justify-content: space-between;
    align-items: center;
    padding: 0 5px;
    box-sizing: border-box;
    font-size: 9px;
    z-index: 5;
}
.h-bar-container {
    width: 60px;
    height: 5px;
    background: #111;
    border: 1px solid #040;
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin-right: 5px;
}

/* MEDIA QUERIES PARA RESPONSIVIDADE */

/* Mobile (Qualquer Orienta√ß√£o) - CORRIGIDO: Esconde HUD de PC */
@media (max-width: 1024px) { 
    .hud-bottom { display: none !important; } /* Esconde HUD de PC */
    #hud-gold { display: none !important; } /* Esconde HUD de Gold grande */
}

/* Mobile Horizontal (Landscape) - L√≥gica de CSS mantida */
@media (max-width: 768px) and (orientation: landscape) {
    /* #mobile-controls √© gerenciado por JS no draw() */
    #mobile-menu-buttons { /* Ajusta a posi√ß√£o no canto superior direito para liberar espa√ßo */
        top: 0;
        bottom: auto;
        right: 5px;
    }
}

/* NOVO: Bot√µes de A√ß√£o UI (Aparecem apenas com INV/CHR/CFT abertos) */
.ui-action-buttons {
    position: absolute;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    display: none; /* Controlado pelo JS */
    gap: 15px;
    pointer-events: auto;
    z-index: 100;
}
.ui-action-buttons .btn {
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 5px;
    border: 2px solid #fff;
    background: rgba(0,0,0,0.8);
    color: #fff;
    cursor: pointer;
}
.ui-action-buttons .btn:hover {
    background: #fff;
    color: #000;
}

</style>
</head>
<body oncontextmenu="return false">
<canvas id="c"></canvas>
<div class="scanlines"></div>
<div id="tooltip"></div>

<div id="ui-layer">
    <div id="hud-gold">GOLD: 0</div>

    <div id="hud-horizontal-mobile">
        <span id="h-lvl-txt" style="color:#0f0;">NORMAL [1]</span>
        <div style="flex-grow: 1; text-align: center;">
            <span id="h-gold-txt" style="color:#fb0;">0G</span>
        </div>
        <div>
            <span style="color:#f00; font-weight: bold;">HP</span>
            <div class="h-bar-container"><div class="fill hp" id="h-hp-bar"></div></div>
        </div>
        <div>
            <span style="color:#00f; font-weight: bold;">MP</span>
            <div class="h-bar-container"><div class="fill mp" id="h-mp-bar"></div></div>
        </div>
        <div style="width: 80px;">
            <span style="color:#fb0; font-weight: bold;">EXP</span>
            <div class="h-bar-container" style="width: 100%;"><div class="fill xp" id="h-xp-bar"></div></div>
        </div>
    </div>
    
    <div id="chat-container"><input type="text" id="chat-input" placeholder="Say something..." maxlength="30"></div>
    
    <div class="hud-bottom">
        <div class="bar-box">
            <div class="bar-status-text">
                <span id="lvl-txt">NORMAL [1]</span>
                <span id="hp-txt">HP: 100/100</span>
            </div>
            <div class="bar-container hp"><div class="fill hp" id="hp-bar"></div></div>
            
            <div class="bar-status-text" style="color:#0ff;">
                <span>MANA</span>
                <span id="mp-txt">MP: 50/50</span>
            </div>
            <div class="bar-container mp"><div class="fill mp" id="mp-bar"></div></div>
            
            <div class="bar-status-text" style="color:#fb0;">
                <span>EXP</span>
                <span id="xp-txt">0%</span>
            </div>
            <div class="bar-container xp"><div class="fill xp" id="xp-bar"></div></div>
        </div>
        <div class="skills">
            <div class="skill-btn">ATK</div>
            <div class="skill-btn" id="skill-1"><span class="key-hint">E</span>SKL</div>
            <div class="skill-btn" id="skill-dash"><span class="key-hint">SPC</span>DSH</div>
            <div class="skill-btn" id="hud-potion"><span class="key-hint">E</span>POT</div>
            <div class="skill-btn"><span class="key-hint">I</span>INV</div>
            <div class="skill-btn"><span class="key-hint">K</span>CFT</div>
            <div class="skill-btn"><span class="key-hint">C</span>CHR</div>
        </div>
    </div>
    
    <div id="inventory" class="panel">
        <div style="text-align:center; border-bottom:1px dashed #0f0; font-size:14px; padding-bottom:5px;">[ BACKPACK ]</div>
        <div style="font-size:9px; color:#aaa; text-align:center;">Drag Gem to Item to Socket</div>
        <div class="grid" id="inv-grid"></div>
    </div>

    <div id="craft-panel" class="panel">
        <div style="text-align:center; border-bottom:1px dashed #f0f; font-size:14px; padding-bottom:5px;">[ CRAFTING ]</div>
        <div id="craft-list" style="max-height: 200px; overflow-y: auto;"></div>
    </div>

    <div id="shop-panel" class="panel">
        <div style="text-align:center; border-bottom:1px dashed #0ff; font-size:14px; padding-bottom:5px;">[ MERCHANT ]</div>
        <div class="grid" id="shop-grid" style="grid-template-columns:repeat(5, 1fr);"></div>
        <div style="text-align:center; margin-top:5px; font-size:10px;">Click to Buy</div>
    </div>
    
    <div id="char-panel" class="panel">
        <div style="text-align:center; border-bottom:1px dashed #0f0; font-size:14px; margin-bottom:10px;">[ ATTRIBUTES ]</div>
        <div class="equip-slots">
            <div class="slot" id="eq-head" title="Head"></div>
            <div class="slot" id="eq-body" title="Body"></div>
            <div class="slot" id="eq-hand" title="Hand"></div>
            <div class="slot" id="eq-rune" title="Rune"></div> 
            <div class="slot" id="eq-potion" title="Potion (E)"></div>
        </div>
        <div style="text-align:center; color:#fb0; margin-bottom:10px;">PTS: <span id="cp-pts">0</span></div>
        <div class="stat-row"><span>STR</span> <div><span id="val-str">5</span> <div class="plus-btn" id="btn-str" onclick="addStat('str')">+</div></div></div>
        <div class="stat-row"><span>DEX</span> <div><span id="val-dex">5</span> <div class="plus-btn" id="btn-dex" onclick="addStat('dex')">+</div></div></div>
        <div class="stat-row"><span>INT</span> <div><span id="val-int">5</span> <div class="plus-btn" id="btn-int" onclick="addStat('int')">+</div></div></div>
        <hr style="border:0; border-top:1px dashed #0f0"><div style="font-size:11px; color:#0f0;">DMG: <span id="stat-dmg">0</span> | SPD: <span id="stat-spd">0</span></div>
    </div>
</div>

<div class="ui-action-buttons" id="ui-action-buttons">
    <button class="btn" id="ui-btn-equip" onclick="handleGamepadAction()">EQUIPAR / USAR (A)</button>
    <button class="btn" id="ui-btn-drop" onclick="handleGamepadSecondaryAction()">DROPAR (B)</button>
</div>

<div id="mobile-controls">
    <div id="joystick-base"></div>
    <div id="joystick-knob" style="display:none;"></div>

    <div id="joystick-area" class="control-area"></div>

    <div id="action-container">
        <div id="btn-potion" class="action-btn" data-action="potion">POT</div>
        <div id="btn-skill" class="action-btn" data-action="skill">SKL</div>
        <div id="btn-dash" class="action-btn" data-action="dash">DSH</div>
        <div id="btn-atk" class="action-btn" data-action="attack">ATK</div>
    </div>
</div>

<div id="mobile-menu-buttons">
    <div id="btn-inv-mobile" class="skill-btn" data-action="toggle_inv">INV</div>
    <div id="btn-char-mobile" class="skill-btn" data-action="toggle_char">CHR</div>
    <div id="btn-craft-mobile" class="skill-btn" data-action="toggle_craft">CFT</div>
</div>

<div id="menu">
    <h1 style="font-size:50px; margin-bottom:0;">DIABLOCK</h1>
    <p style="color:#d00; margin-bottom:20px;">V26 - üî• Legado das Runas Sombrias</p>
    <div id="login-form"><input type="text" id="username" placeholder="USER"><button class="btn" onclick="login()">LOGIN</button></div>
    <div id="char-select" style="display:none; text-align:center;">
        <div id="char-list" style="margin-bottom:20px;"></div>
        <input type="text" id="cname" placeholder="NAME">
        <select id="cclass"><option value="knight">WARRIOR</option><option value="hunter">RANGER</option><option value="mage">WIZARD</option></select>
        <button class="btn" onclick="create()">CREATE</button>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script src="/game.js"></script>
</body>
</html>